import os
import socket

$HOST=socket.gethostname()

# conda env switcher sets $CONDA_DEFAULT_ENV
# preserve current path if that is set
if 'CONDA_DEFAULT_ENV' not in __xonsh_env__:
    $PATH=['/usr/bin','/usr/local/bin', '/usr/bin/vendor_perl/', '/usr/bin/core_perl/']

    if $HOST=='theo':
        if '/home/gil/anaconda/bin' not in $PATH:
            $PATH.insert(0,'/home/gil/anaconda/bin')
            $PATH.append('/opt/cuda/bin')
        $WORKON_HOME='/home/gil/anaconda/envs'

    elif $HOST=='bad_cat': 
        if '/home/gil/miniconda3/bin' not in $PATH:
            $PATH.insert(0,'/home/gil/miniconda3/bin')
        $WORKON_HOME='/home/gil/miniconda3/envs'

if 'SSH_AUTH_SOCK' not in __xonsh_env__:
    evalx("keychain --quiet ~/.ssh/id_ed25519")
    with open(os.path.expanduser('~') + '/.keychain/' + $HOST + '-sh','r') as f:
        data = f.read()
        data = data.split()

    $SSH_AUTH_SOCK = data[0].split('=')[1][:-1]
    $SSH_AGENT_PID = data[3].split('=')[1][:-1]

$SHELL_TYPE='prompt_toolkit'

#Enable AUTO_CD
$AUTO_CD=True
#Enable vim_mode
$VI_MODE=True

##Completion funtimes
$BASH_COMPLETIONS[0]='/usr/share/bash-completion/bash_completion'

completions = ['arch', 'git', 'systemctl']

for i in completions:
    comp = '/usr/share/bash-completion/completions/{}'.format(i)
    if not os.path.isfile(comp):
        continue

    if not comp in $BASH_COMPLETIONS:
		$BASH_COMPLETIONS.append(comp)

##Helper functions

def _lock_screen(args, stdin=None):
    scrot /tmp/screen.png
    convert /tmp/screen.png -scale 10% -scale 1000% /tmp/screen.png
    i3lock -d -i /tmp/screen.png
        
##Aliases (yeah... no shit, kid)
aliases['lock'] = _lock_screen
aliases['feh'] = 'feh -. --magick-timeout 1'
aliases['dropbox'] = 'dropbox-cli'
aliases['grep'] = 'grep -i --color=always'
aliases['mkdir'] = 'mkdir -p'
aliases['music'] = 'mps'
aliases['dd'] = 'dcfldd'
aliases['pyselect'] = 'source pyselect'
aliases['ping'] = 'ping -4'
aliases['lookup'] = '/usr/bin/dict' #collision with Python dict
aliases['vpn'] = ['sudo', 'openconnect', 'go.vpn.gwu.edu']

##git aliases
aliases['gs'] = 'git status' #collides with ghostscript but who cares?
aliases['ga'] = 'git add' 
aliases['gd'] = 'git diff' 
aliases['gch'] = 'git checkout' 
aliases['gc'] = 'git commit -v' 

$BROWSER="firefox"
$TERM="rxvt-unicode-256color"

#EMACS stuff
$ALTERNATE_EDITOR='emacs'
$EDITOR='emacsclient'
$VISUAL='emacsclient'

#Encoding
$LANG="en_US.UTF-8"
$LC_ALL="en_US.UTF-8"

#default colorscheme
$XONSH_COLOR_STYLE='algol_nu'

#keep the prompt short
$DYNAMIC_CWD_WIDTH='20%'

#xontrib loading
xontrib load pacman_tabcomplete
xontrib load xonda

del os
del socket
